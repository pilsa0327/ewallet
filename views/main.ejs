<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="css/style.css">
  <script src="http://code.jquery.com/jquery-latest.js"></script>
  <title> <%= userid %>'s Wallet</title>
</head>

<body>
  <div class="container">
    <header>
      <h2><%= userid %>'s Wallet</h2>
    </header>

    <section class="content">
      <nav>
        <img class="logo" src="images/ether_logo.png">
      </nav>
      <main class="mainPage">
        <div class="context">
          <div class="item2" id="text">Address </div>
          <div class="item2 address" id="text1"><%= public_key %></div>
          <div class="item2" id="text">Balance</div>
          <div class="item2" id="text1"> <%= balance %> ETH </div>
          <div id="text1">
            <button type="button" id="btn1">입 금</button>
            <button type="button" id="btn2">출 금</button>
          </div>
          <div id="text"> History</div>
          <div id="text">
            <ul id="txns">

            </ul>

          </div>

        </div>

      </main>
    </section>

    <footer>
        <button type="button" id="btn3">개인키 내보내기</button>
      <button type="button" id="btn4">로그아웃</button>
      
    </footer>

    <script>
      $('#btn2').click(function () {
        window.location.href = 'http://localhost:3000/send'
      })
      $('#btn3').click(function () {
        window.location.href = 'http://localhost:3000/privatekey/export'
      })


      $(document).ready(() => {
        $('#btn4').click(function () {
          $.ajax({
            url: 'http://localhost:3000/main/destroy',
            success: () => {
              window.location.href = 'http://localhost:3000/'
            }
          })
        })
      })
      
      function generateTxnsItem(txHash) {
        return `<li>${txHash}</li>`
      }
      $(document).ready(() => {
        $('#btn1').click(function () {
          let address = $('.address').text()
          $.ajax({
            url: 'https://faucet.metamask.io',
            type: 'post',
            processData: false,
            data: address,
            success: (txHash, body, { status }) => {
              // 서버로 저장되는 코드
              console.log(txHash)
              $('#txns').append(generateTxnsItem(txHash))

              $.ajax({
              url: 'http://localhost:3000/main/txdb',
              type: 'post',
              processData: false,
              data: {txHash}
              })
            },
            error: ({ status }) => {
              const statusMsg = {
                "429": () => alert('Too many request'),
                "500": () => alert('Fauset ServerError'),
              }
              let msg = statusMsg[`${status}`]

              if (msg) msg()
            }
          })
        })
      })

    </script>

  </div>

</body>

</html>